{% extends 'main/base.html' %}
{% load static %}
{% load photo_extras %}

{% block title %}Matches - DigiMat{% endblock %}
{% block page_title %}Matches{% endblock %}

{% block content %}
<style>
    .matches-body { font-family: 'Open Sans', Arial, sans-serif; margin:0; padding:1rem; background: linear-gradient(135deg,#f8f9fa 0%,#fff 100%); min-height:100vh }
    .container { max-width:900px; margin:0 auto }
    .card { background:#fff; padding:1rem; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.06); margin:0.75rem 0 }
    .profile-grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(220px,1fr)); gap:1rem }
    .profile { padding:0.75rem }
    .btn { background:#128c7e; color:#fff; padding:0.5rem 0.8rem; border-radius:6px; text-decoration:none }
    @media(max-width:600px){ .profile-grid{ grid-template-columns: repeat(1,1fr) } }
</style>

<div class="container matches-body">
    <div class="card">
        {% if not me_complete %}
            <div style="padding:0.75rem; background:#fff3cd; border-radius:8px; margin-bottom:1rem; color:#856404">
                Your profile is incomplete. Please <a href="{% url 'profile' %}">complete your Family, Birth and Professional details</a> to see matches.
            </div>
        {% endif %}
        <div class="profile-grid">
            {% if profiles %}
                {% for p in profiles %}
                <a href="{% url 'profile_detail' p.pk %}" class="card profile profile-link" style="text-decoration:none; color:inherit; display:flex; align-items:center;">
                    {% if p.photos.count %}
                        {% with primary_photo=p.photos|get_primary %}
                            {% if primary_photo %}
                                <img src="{{ primary_photo.image.url }}" alt="Profile Photo" class="rounded" style="width:60px;height:60px;object-fit:cover;margin-right:16px;">
                            {% else %}
                                <img src="{{ p.photos.first.image.url }}" alt="Profile Photo" class="rounded" style="width:60px;height:60px;object-fit:cover;margin-right:16px;">
                            {% endif %}
                        {% endwith %}
                    {% else %}
                        {% if p.gender == 'M' %}
                            <img src="{% static 'icons/male_icon.svg' %}" alt="Male" class="rounded" style="width:60px;height:60px;object-fit:cover;margin-right:16px;background:#f0f0f0;">
                        {% else %}
                            <img src="{% static 'icons/female_icon.svg' %}" alt="Female" class="rounded" style="width:60px;height:60px;object-fit:cover;margin-right:16px;background:#f0f0f0;">
                        {% endif %}
                    {% endif %}
                    <div style="flex:1;">
                        <h3 style="margin-bottom:8px;font-size:18px;">{{ p.user.first_name }} {{ p.user.last_name }}</h3>
                        <p style="margin-bottom:4px;font-size:15px;">XXXXXX{{ p.mobile|slice:"6:10" }}</p>
                        <p style="margin-bottom:0;font-size:15px;">{{ p.get_gender_display }}</p>
                    </div>
                </a>
                {% endfor %}
            {% else %}
                <div class="card" style="height:60vh; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; background:#128c7e;">
                    <img src="{% static 'icons/noitems.svg' %}" alt="No items" style="width:80px;height:80px;opacity:0.7;">
                    <div style="color:#fff;font-size:18px;margin-top:16px;text-align:center;">No matching profiles found.</div>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
